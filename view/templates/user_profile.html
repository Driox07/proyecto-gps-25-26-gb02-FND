<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.nick }} - Perfil | OverSound</title>
    <link rel="stylesheet" href="{{ url_for('static', path='styles/user_profile.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/header.css') }}">
</head>
<body>
    {% include 'common/header.html' %}
    
    <main class="profile-main">
        <!-- Profile Header Section -->
        <section class="profile-header">
            <div class="profile-header-content">
                <div class="profile-image-container">
                    {% if user.imagen %}
                        <img src="{{ user.imagen }}" alt="{{ user.username }}" class="profile-image">
                    {% else %}
                        <div class="profile-image-placeholder">
                            {{ user.username[0].upper() }}
                        </div>
                    {% endif %}
                </div>
                
                <div class="profile-info">
                    <h1 class="profile-nickname">{{ user.username }}</h1>
                    <h2 class="profile-fullname">{{ user.firstName }} {{ user.lastName }}</h2>
                    
                    {% if user.biografia %}
                        <p class="profile-bio">{{ user.biografia }}</p>
                    {% else %}
                        <p class="profile-bio empty">Sin biografía</p>
                    {% endif %}
                    
                    <div class="profile-meta">
                        <div class="meta-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"></line>
                                <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"></line>
                                <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"></line>
                            </svg>
                            <span>Miembro desde {{ user.regDate }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <a href="/profile/edit" class="btn btn-primary">Editar Perfil</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Payment Methods Section -->
        {% if is_own_profile %}
        <section class="payment-methods-section">
            <div class="payment-container">
                <div class="payment-header">
                    <div class="payment-title-group">
                        <h2 class="payment-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2" stroke-width="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10" stroke-width="2"></line>
                            </svg>
                            Métodos de Pago
                        </h2>
                        <p class="payment-subtitle">Gestiona tus métodos de pago de forma segura</p>
                    </div>
                    <button class="btn btn-primary add-payment-btn" id="add-payment-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="12" y1="5" x2="12" y2="19" stroke-width="2"></line>
                            <line x1="5" y1="12" x2="19" y2="12" stroke-width="2"></line>
                        </svg>
                        Agregar Tarjeta
                    </button>
                </div>

                <div class="payment-methods-grid" id="payment-methods-grid">
                    <!-- Métodos de pago cargados dinámicamente -->
                </div>

                <!-- Payment Methods Modal -->
                <div class="payment-modal-overlay" id="payment-modal-overlay">
                    <div class="payment-modal">
                        <div class="modal-header">
                            <h3>Agregar Método de Pago</h3>
                            <button class="modal-close" id="modal-close">×</button>
                        </div>
                        
                        <form id="payment-form" class="payment-form">
                            <div class="form-group">
                                <label for="card-name">Nombre en la Tarjeta</label>
                                <input type="text" id="card-name" placeholder="Juan García" required>
                            </div>

                            <div class="form-group">
                                <label for="card-number">Número de Tarjeta</label>
                                <input type="text" id="card-number" placeholder="0000 0000 0000 0000" maxlength="19" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="card-expiry">Vencimiento</label>
                                    <input type="text" id="card-expiry" placeholder="MM/YY" maxlength="5" required>
                                </div>
                                <div class="form-group">
                                    <label for="card-cvv">CVV</label>
                                    <input type="text" id="card-cvv" placeholder="000" maxlength="3" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="card-type">Tipo de Tarjeta</label>
                                <select id="card-type" required>
                                    <option value="credit">Tarjeta de Crédito</option>
                                    <option value="debit">Tarjeta de Débito</option>
                                </select>
                            </div>

                            <div class="form-group checkbox">
                                <input type="checkbox" id="set-default" checked>
                                <label for="set-default">Establecer como método por defecto</label>
                            </div>

                            <button type="submit" class="btn btn-primary full-width">Guardar Tarjeta</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Artist Section -->
        <section class="artist-section" id="artist-section">
            <div class="artist-container">
                <div class="artist-header">
                    <h2>Perfil de Artista</h2>
                    <p class="artist-subtitle">Gestiona tu perfil de artista</p>
                </div>
                
                <div class="artist-content" id="artist-content">
                    <!-- Contenido cargado dinámicamente -->
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Cargando información...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Label Section -->
        <section class="label-section" id="label-section">
            <div class="label-container">
                <div class="label-header">
                    <h2>Discográfica</h2>
                    <p class="label-subtitle">Gestiona tu discográfica</p>
                </div>
                
                <div class="label-content" id="label-content">
                    <!-- Contenido cargado dinámicamente -->
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Cargando información...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Favorites Section -->
        <section class="favorites-section">
            <div class="favorites-container">
                
                <!-- Canciones Favoritas -->
                <div class="favorites-category">
                    <div class="category-header">
                        <h2 class="category-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M9 18V5l12-2v13M9 18c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm12-2c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z" stroke-width="2"/>
                            </svg>
                            Canciones Favoritas
                        </h2>
                        <span class="category-count">{{ canciones_favoritas|length if canciones_favoritas else 0 }}</span>
                    </div>
                    
                    <div class="favorites-grid">
                        {% if canciones_favoritas %}
                            {% for cancion in canciones_favoritas %}
                                <div class="favorite-card">
                                    <div class="card-image">
                                        {% if cancion.cover %}
                                            <img src="{{ cancion.cover }}" alt="{{ cancion.title }}">
                                        {% else %}
                                            <div class="card-image-placeholder">
                                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path d="M9 18V5l12-2v13M9 18c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm12-2c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z" stroke-width="2"/>
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="card-overlay">
                                            <button class="play-button">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <h3 class="card-title">{{ cancion.title }}</h3>
                                        <p class="card-subtitle">{{ cancion.artist.artisticName if cancion.artist else 'Artista Desconocido' }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M9 18V5l12-2v13M9 18c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm12-2c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z" stroke-width="2"/>
                                </svg>
                                <p>No tienes canciones favoritas aún</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Álbumes Favoritos -->
                <div class="favorites-category">
                    <div class="category-header">
                        <h2 class="category-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                                <circle cx="12" cy="12" r="3" stroke-width="2"></circle>
                            </svg>
                            Álbumes Favoritos
                        </h2>
                        <span class="category-count">{{ albumes_favoritos|length if albumes_favoritos else 0 }}</span>
                    </div>
                    
                    <div class="favorites-grid">
                        {% if albumes_favoritos %}
                            {% for album in albumes_favoritos %}
                                <div class="favorite-card">
                                    <div class="card-image">
                                        {% if album.cover %}
                                            <img src="{{ album.cover }}" alt="{{ album.title }}">
                                        {% else %}
                                            <div class="card-image-placeholder">
                                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                                                    <circle cx="12" cy="12" r="3" stroke-width="2"></circle>
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="card-overlay">
                                            <button class="play-button">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <h3 class="card-title">{{ album.title }}</h3>
                                        <p class="card-subtitle">{{ album.artist.artisticName if album.artist else 'Artista Desconocido' }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                                    <circle cx="12" cy="12" r="3" stroke-width="2"></circle>
                                </svg>
                                <p>No tienes álbumes favoritos aún</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Artistas Favoritos -->
                <div class="favorites-category">
                    <div class="category-header">
                        <h2 class="category-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke-width="2"></path>
                                <circle cx="12" cy="7" r="4" stroke-width="2"></circle>
                            </svg>
                            Artistas Favoritos
                        </h2>
                        <span class="category-count">{{ artistas_favoritos|length if artistas_favoritos else 0 }}</span>
                    </div>
                    
                    <div class="favorites-grid">
                        {% if artistas_favoritos %}
                            {% for artista in artistas_favoritos %}
                                <div class="favorite-card artist-card">
                                    <div class="card-image artist-image">
                                        {% if artista.artisticImage %}
                                            <img src="{{ artista.artisticImage }}" alt="{{ artista.artisticName }}">
                                        {% else %}
                                            <div class="card-image-placeholder">
                                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke-width="2"></path>
                                                    <circle cx="12" cy="7" r="4" stroke-width="2"></circle>
                                                </svg>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="card-content">
                                        <h3 class="card-title">{{ artista.artisticName }}</h3>
                                        <p class="card-subtitle">Artista</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke-width="2"></path>
                                    <circle cx="12" cy="7" r="4" stroke-width="2"></circle>
                                </svg>
                                <p>No tienes artistas favoritos aún</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        // Configuración de servidores para JavaScript
        const SERVER_CONFIG = {
            SYU: "{{ syu_server }}",
            TYA: "{{ tya_server }}"
        };
    </script>
    <script src="{{ url_for('static', path='js/UserProfile.js') }}"></script>
</body>
</html>
